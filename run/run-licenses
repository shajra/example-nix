#! /usr/bin/env nix-shell
#! nix-shell -I nixpkgs=https://github.com/NixOS/nixpkgs-channels/archive/9a3e34ae60130c63b93809eecf555b0d796f001c.tar.gz
#! nix-shell -i bash -p jq -p gnused
set -eu


. "$(dirname "$0")/common.sh"


show_report()
(
    project="$1"
    jq --color-output --unbuffered . < "$(build_report "$project")"
)

build_report()
(
    project="$1"
    build_expr="$(project_root "$project")/build.nix"
    nix build --show-trace --no-link \
        --file "$build_expr" "example-$project-licenses"
    nix path-info --file "$build_expr" "example-$project-licenses"
)


run show_report "${1:-}"
